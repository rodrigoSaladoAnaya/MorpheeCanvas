<html>
	<head>
		<script type="text/javascript" src="jquery-1.9.0.js">
		</script>
		<script type="text/javascript">
			var Datos = {
				contexto: null,
				pageX: 0,
				pageY: 0,
				isLineToOn: false,
				getInitialPosX: function(){ return this.pageX -  $("#area-dibujo").offset().left},
				getInitialPosY: function(){ return this.pageY -  $("#area-dibujo").offset().top },
			}

			$(document).ready(function(){
				ponePropiedadesDelAreaDeDibujo();
				muestraMensajeDeEspera();
				iniciaAreaDeDibujo();
				comportamientoDelAreaDeDibujo();
				comportamientoDeNuevaLinea();
			});

			var comportamientoDeNuevaLinea = function(){
				$("#nueva-linea").click(function(){ 
					Datos.isLineToOn = !Datos.isLineToOn;
					Datos.contexto.beginPath();
					imprimeConsolaDeSalida();
				});
			};

			var comportamientoDelAreaDeDibujo = function(){
				$("#area-dibujo").mousemove(function(e){
					Datos.pageX = e.pageX;
					Datos.pageY = e.pageY;
					imprimeConsolaDeSalida();
				}).click(function(){
					var x = Datos.getInitialPosX();
					var y = Datos.getInitialPosY();
					Datos.contexto.lineTo(x, y);
					var codigo = "ctx.lineTo("+ x +", " + y +");<br/>";
					Datos.contexto.stroke();
				}).mouseout(function(){
					muestraMensajeDeEspera();
				});
			};

			var ponePropiedadesDelAreaDeDibujo = function(){
				$("#area-dibujo")
					.attr("width", "200")
					.attr("height", "200");
				$("#area-dibujo").css("border","1px solid");
			};

			var muestraMensajeDeEspera = function(){
				$("#console-de-salida").html("> Awaiting a position...");
			};

			var imprimeConsolaDeSalida = function(pageX, pageY){
				var salida = "> x: " + Datos.pageX + ", y: " + Datos.pageY + "<br/>";
				$("#console-de-salida").html(salida);	
			};

			var iniciaAreaDeDibujo = function(){
				Datos.contexto = $("#area-dibujo")[0].getContext("2d");
				Datos.contexto.beginPath();
			};
		</script>
	</head>
	<body>
		<canvas id="area-dibujo" border=1px></canvas>
		<button type="button" id="nueva-linea">New line</button>
		<div id="console-de-salida" />
	</body>
</html>